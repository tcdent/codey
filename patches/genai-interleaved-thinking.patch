--- genai-interleaved-thinking.patch ---
Description: Add extra_headers support to Anthropic adapter for interleaved thinking
Target: genai crate v0.4.x
File: src/adapter/adapters/anthropic/adapter_impl.rs

This patch enables custom headers to be passed to the Anthropic API, which is
required for the `interleaved-thinking-2025-05-14` beta feature.

The OpenAI adapter already supports extra_headers, but the Anthropic adapter
was missing this functionality.

--- PATCH ---

diff --git a/src/adapter/adapters/anthropic/adapter_impl.rs b/src/adapter/adapters/anthropic/adapter_impl.rs
--- a/src/adapter/adapters/anthropic/adapter_impl.rs
+++ b/src/adapter/adapters/anthropic/adapter_impl.rs
@@ -107,12 +107,17 @@ impl Adapter for AnthropicAdapter {

 		// -- headers
-		let headers = Headers::from(vec![
+		let mut headers = Headers::from(vec![
 			// headers
 			("x-api-key".to_string(), api_key),
 			("anthropic-beta".to_string(), "effort-2025-11-24".to_string()),
 			("anthropic-version".to_string(), ANTHROPIC_VERSION.to_string()),
 		]);

+		// Merge extra headers from chat options (allows overriding anthropic-beta for interleaved thinking)
+		if let Some(extra_headers) = options_set.extra_headers() {
+			headers.merge_with(extra_headers);
+		}
+
 		// -- Parts
 		let AnthropicRequestParts {

--- END PATCH ---

Usage in Codey:
```rust
let chat_options = ChatOptions::default()
    .with_reasoning_effort(ReasoningEffort::Budget(16000))
    .with_capture_reasoning_content(true)
    .with_extra_headers(Headers::from([(
        "anthropic-beta".to_string(),
        "interleaved-thinking-2025-05-14".to_string(),
    )]));
```

Note: The extra_headers will REPLACE the default anthropic-beta header, so if you
need both beta features, combine them:
```rust
.with_extra_headers(Headers::from([(
    "anthropic-beta".to_string(),
    "interleaved-thinking-2025-05-14,effort-2025-11-24".to_string(),
)]))
```
